name = "xaostech-data"
compatibility_date = "2025-12-31"
main = "src/index.ts"
send_metrics = false

[env.production]
name = "xaostech-data"
main = "src/index.ts"
routes = [{ pattern = "data.xaostech.io/*", zone_name = "xaostech.io" }]

[env.production.vars]
COOKIE_DOMAIN = ".xaostech.io"
COOKIE_SECURE = "true"
COOKIE_HTTP_ONLY = "true"
COOKIE_SAME_SITE = "Strict"
GDPR_REQUIRED = "true"

# =============================================================================
# D1 DATABASES - Centralized data access (all requests via API worker)
# =============================================================================
[[env.production.d1_databases]]
binding = "DB"
database_name = "data-db"
database_id = "${D1_DATA_DB_ID}"

[[env.production.d1_databases]]
binding = "ACCOUNT_DB"
database_name = "account-db"
database_id = "${D1_ACCOUNT_DB_ID}"

[[env.production.d1_databases]]
binding = "BLOG_DB"
database_name = "blog-db"
database_id = "${D1_BLOG_DB_ID}"

[[env.production.d1_databases]]
binding = "LINGUA_DB"
database_name = "lingua-db"
database_id = "${D1_LINGUA_DB_ID}"

[[env.production.d1_databases]]
binding = "EDU_DB"
database_name = "edu-xaostech-db"
database_id = "${D1_EDU_DB_ID}"

[[env.production.d1_databases]]
binding = "PAYMENTS_DB"
database_name = "payments-db"
database_id = "${D1_PAYMENTS_DB_ID}"

[[env.production.d1_databases]]
binding = "CHAT_DB"
database_name = "chat-db"
database_id = "${D1_CHAT_DB_ID}"

[[env.production.d1_databases]]
binding = "AI_DB"
database_name = "ai-db"
database_id = "${D1_AI_DB_ID}"

# =============================================================================
# KV NAMESPACES
# =============================================================================

[[env.production.kv_namespaces]]
binding = "CONSENT_KV"
id = "${KV_CONSENT_ID}"

[[env.production.kv_namespaces]]
binding = "SESSIONS_KV"
id = "${KV_SESSIONS_ID}"

# =============================================================================
# R2 BUCKETS
# =============================================================================
[[env.production.r2_buckets]]
binding = "IMG"
bucket_name = "img"

[[env.production.r2_buckets]]
binding = "BLOG_MEDIA"
bucket_name = "blog-media"

[env.testing]
routes = [{ pattern = "data.testing.local/*", zone_name = "localhost" }]

[env.testing.vars]
COOKIE_DOMAIN = ".testing.local"
COOKIE_SECURE = "false"
COOKIE_HTTP_ONLY = "true"
COOKIE_SAME_SITE = "Strict"
GDPR_REQUIRED = "true"

[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1